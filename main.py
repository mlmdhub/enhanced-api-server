import sys
import json
import subprocess
import time

from requestor import net,file
from utils import time_spliter

words = [
    "死",
    "错",
    "黑",
    "求",
    "希望",
    "怕",
    "支持",
    "加油",
    "转发",
    "累",
    "哭",
    "鸡",
    "诉",
    "恶",
    "学习",
    "痛苦",
    "无法",
    "说我",
    "滚",
    "粉丝",
    "id",
    "结束",
    "骗",
    "骂",
    "接受",
    "恨",
    "妈的",
    "放弃",
    "帮助",
    "悔",
    "理解",
    "压力",
    "喷",
    "逃",
    "怒",
    "熬",
    "睡不着",
    "错了",
    "伤害",
    "坚强",
    "害怕",
    "恶心",
    "恼",
    "假的",
    "网上",
    "失眠",
    "对不起",
    "盗",
    "不对",
    "无语",
    "傻逼",
    "欠",
    "勇气",
    "私信",
    "积极",
    "原谅",
    "生气",
    "勇敢",
    "悲伤",
    "尊重",
    "崩溃",
    "会好",
    "委屈",
    "焦虑",
    "混乱",
    "曝光",
    "过分",
    "承受",
    "敏感",
    "无力",
    "变态",
    "屏蔽",
    "良心",
    "不舒服",
    "吵架",
    "扩散",
    "黑暗",
    "不应该",
    "举报",
    "公平",
    "无所谓",
    "豆瓣",
    "权利",
    "邪恶",
    "恐惧",
    "犯罪",
    "头疼",
    "去死",
    "愤怒",
    "疾病",
    "停止",
    "限制",
    "道歉",
    "针对",
    "艰难",
    "烦躁",
    "报警",
    "破坏",
    "代价",
    "骂人",
    "欺骗",
    "迷茫",
    "糟糕",
    "谎言",
    "传播",
    "警告",
    "批评",
    "删除",
    "正义",
    "打扰",
    "无耻",
    "截图",
    "攻击",
    "证据",
    "诈骗",
    "反思",
    "抑郁",
    "嘲笑",
    "诅咒",
    "阴阳",
    "忍受",
    "骗人",
    "惩罚",
    "谣言",
    "抱歉",
    "发泄",
    "忍耐",
    "噩梦",
    "邮箱",
    "威胁",
    "人肉",
    "公正",
    "应对",
    "不放弃",
    "报复",
    "被骗",
    "骚扰",
    "忘掉",
    "自杀",
    "反省",
    "抄袭",
    "逃离",
    "伪装",
    "我错了",
    "贴吧",
    "热搜",
    "无助",
    "罪过",
    "不正常",
    "正当",
    "造谣",
    "实名",
    "炒作",
    "歧视",
    "恶搞",
    "舆论",
    "罪恶",
    "愚蠢",
    "隐私",
    "辟谣",
    "讽刺",
    "拉黑",
    "侮辱",
    "骂我",
    "厌恶",
    "指责",
    "诉说",
    "抑制",
    "解脱",
    "求求",
    "刻意",
    "脏话",
    "妓",
    "倾诉",
    "看不起",
    "难听",
    "天理",
    "恶意",
    "澄清",
    "大哭",
    "低俗",
    "气愤",
    "抖音",
    "扭曲",
    "放纵",
    "遭到",
    "关掉",
    "善意",
    "维权",
    "丢脸",
    "被骂",
    "贪婪",
    "负面",
    "小号",
    "有罪",
    "释怀",
    "怼",
    "操蛋",
    "毁掉",
    "起诉",
    "发疯",
    "流传",
    "缺德",
    "抑郁症",
    "网络上",
    "检讨",
    "愧疚",
    "谅解",
    "公道",
    "被黑",
    "闭嘴",
    "受害者",
    "知乎",
    "伤疤",
    "误导",
    "撒谎",
    "造假",
    "摧毁",
    "判决",
    "偏见",
    "振作",
    "跟踪",
    "封杀",
    "侵犯",
    "自责",
    "偏执",
    "冒充",
    "调侃",
    "创伤",
    "肮脏",
    "逞强",
    "负能量",
    "下半身",
    "摄像头",
    "卸载",
    "罪人",
    "憋屈",
    "坏话",
    "洗白",
    "黑子",
    "妓女",
    "诋毁",
    "排斥",
    "无节操",
    "遭受",
    "懊恼",
    "娼",
    "挨骂",
    "辩护",
    "恶毒",
    "大v ",
    "流言",
    "团伙",
    "释然",
    "小红书",
    "打乱",
    "不想出门",
    "不喜欢我",
    "辱骂",
    "宽恕",
    "受够了",
    "被封",
    "传言",
    "驱逐",
    "隐忍",
    "羞耻",
    "卖淫",
    "淫荡",
    "恨死",
    "忘不掉",
    "谩骂",
    "抗争",
    "改正",
    "欺诈",
    "玻璃心",
    "聊天记录",
    "败坏",
    "拖累",
    "恐吓",
    "扛不住",
    "私生活",
    "个人信息",
    "诽谤",
    "卑鄙",
    "悔过",
    "注销",
    "口是心非",
    "羞辱",
    "骗钱",
    "抹黑",
    "控诉",
    "下流",
    "龌龊",
    "踢出",
    "改名字",
    "敲诈勒索",
    "活不下去",
    "开骂",
    "歉意",
    "群聊",
    "编造",
    "卑劣",
    "变坏",
    "取笑",
    "散播",
    "断章取义",
    "铺天盖地",
    "道德绑架",
    "强颜欢笑",
    "个人资料",
    "zs",
    "揣测",
    "怨恨",
    "删微博",
    "被害人",
    "微信群",
    "法律责任",
    "无法入睡",
    "煽动",
    "黑锅",
    "娘炮",
    "终止",
    "破防",
    "不正当",
    "心理咨询",
    "压榨",
    "盗用",
    "公证",
    "不雅",
    "负罪",
    "不齿",
    "流言蜚语",
    "手脚冰凉",
    "人身攻击",
    "离我远点",
    "无法原谅",
    "社交网站",
    "热榜",
    "取证",
    "难堪",
    "聒噪",
    "心里堵",
    "上新闻",
    "有组织",
    "网络暴力",
    "寻求帮助",
    "指指点点",
    "逃避现实",
    "个人隐私",
    "网暴",
    "咒骂",
    "哭诉",
    "擦边",
    "乱搞",
    "淫秽",
    "黑料",
    "成见",
    "逐出",
    "排挤",
    "假扮",
    "键盘侠",
    "逼急了",
    "博关注",
    "肖像权",
    "聊天室",
    "社交平台",
    "呼吸困难",
    "战战兢兢",
    "骚扰电话",
    "不怀好意",
    "消沉",
    "母狗",
    "卖肉",
    "膈应",
    "污蔑",
    "禁言",
    "亵渎",
    "盗取",
    "割韭菜",
    "负罪感",
    "区别对待",
    "抑制不住",
    "停更",
    "卖惨",
    "追责",
    "雪崩",
    "杜撰",
    "诬陷",
    "割裂",
    "偏袒",
    "污秽",
    "没教养",
    "阴阳怪气",
    "见不得人",
    "三观不正",
    "吃瓜群众",
    "颠倒是非",
    "假装坚强",
    "没有停止",
    "利己主义者",
    "拉踩",
    "黄腔",
    "敌意",
    "死亡威胁",
    "偷换概念",
    "法律程序",
    "人人喊打",
    "心理疏导",
    "因果报应",
    "害人不浅",
    "法外之地",
    "公道自在人心",
    "ji女",
    "厌女",
    "退网",
    "失德",
    "极坏",
    "强装",
    "视奸",
    "被网暴",
    "名誉权",
    "心机婊",
    "博流量",
    "中专生",
    "掐头去尾",
    "混淆视听",
    "绝不姑息",
    "剜心刻骨",
    "微博关了",
    "冷漠无情",
    "负面评价",
    "张冠李戴",
    "保持心态",
    "性爱视频",
    "凭空想象",
    "水性杨花",
    "给我安慰",
    "威胁恐吓",
    "私人信息",
    "虚假信息",
    "不能登录"
]
start_time='2024-09-22'
end_time='2024-12-22'
date_ranges = time_spliter.split_into_monthly_ranges(start_time, end_time)
weibo_request_list=[]
for word in words:
    for date_range in date_ranges:
        try:
            start_time_str = date_range[0].strftime('%Y-%m-%d-%H')
            end_time_str = date_range[1].strftime('%Y-%m-%d-%H')
            weibo_res = net.Request(f"https://s.weibo.com/weibo?q={word}&typeall=1&suball=1&timescope=custom:{start_time_str}:{end_time_str}&Refer=g", **{
              "headers": {
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
            "accept-language": "en-US,en;q=0.5",
            "accept-encoding": "gzip, deflate, br, zstd",
            # "referer": "https://s.weibo.com/weibo?q=we",
            "upgrade-insecure-requests": "1",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "same-origin",
            "sec-fetch-user": "?1",
            "priority": "u=0, i",
            "te": "trailers",
            "cookie": "SUB=_2A25KbR6ZDeRhGeFH71sS9yrLyT2IHXVpAx5RrDV8PUNbmtANLWTHkW9NewdhO1CTIv3bkwt1hf9NMe2_wBEpfhx6; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WWbN_AhA0N.BwCXWoNGqiWd5NHD95QN1KB4e0MXS0zpWs4DqcjMi--NiK.Xi-2Ri--ciKnRi-zNSoMXe0.EShz7entt; SCF=Ar9Aj4h5KJitaq3_cIzrtRBwciK5pp4ICJKa4Vm33wKFjUmKhFFCHFmeu_Rdv86AZP2T34BuMhhnB9vGSHJq6Kk.; SINAGLOBAL=8765145828962.799.1732036949533; ULV=1734959923438:6:4:1:194007020429.66733.1734959923253:1733483480014; UOR=,,link.csdn.net; _s_tentry=weibo.com; Apache=194007020429.66733.1734959923253; PC_TOKEN=bc341d106d; appkey=; ALF=02_1737554889"
              },
              "method": "GET"
            },callback=(file.ResponseSaver, word+'_'+start_time_str+'_'+end_time_str)).fetch()
            assert not weibo_res.text.startswith("系统检测到您的行为存在异常，暂时无法使用搜索功能!")
        except AssertionError as e:
            time.sleep(500)

# mng=net.RequestManager()
# mng.loop(mng.request,weibo_request_list)